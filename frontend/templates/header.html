<div id='header'>
  <div id='header_left'>
    <div id='header_top_spacer'></div>
    <div class='header_title noselect pointer'>Footprint</div>
    <div class='noselect pointer {% ifequal current_page "MY_EVENTS" %} tab_active {% else %} tab_inactive {% endifequal %}'
         onclick="location.href = '/myevents'"><img src="images/Event-Selected-Star.png"/> My Events</div>
    <div class='noselect pointer {% ifequal current_page "SEARCH" %} tab_active {% else %} tab_inactive {% endifequal %}'
         onclick="location.href = '/'">Find an event</div>
    <div class='noselect pointer {% ifequal current_page "FRIENDS" %} tab_active {% else %} tab_inactive {% endifequal %}'
         onclick="location.href = '/friends'">Work with others</div>
    <div class='noselect pointer {% ifequal current_page "POST" %} tab_active {% else %} tab_inactive {% endifequal %}'
         onclick="location.href = '/post'">Add an event</div>
  </div>

  <script src='http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php' type='text/javascript'></script>
  <script type="text/javascript">
    document.userId = "{{user.user_id}}";
    document.userType = "{{user.account_type}}";
    document.userDisplayName = "{{user.display_name}}";

    var FC_SITE_ID = '02962301966004179520';
    var FB_SITE_ID = 'df68a40a4a90d4495ed03f920f16c333';

    FB.init(FB_SITE_ID, 'xd_receiver.htm');

    google.load('friendconnect', '0.8');
    google.setOnLoadCallback(function() {
      google.friendconnect.container.loadOpenSocialApi({site: FC_SITE_ID, onload: function() {
        {% if not user %} checkForViewer(); {% endif %}
      }});
    });
  </script>

  <div id='header_right' align='right' width='100%'>
   <nobr>
    {% if user %}
    <div class='sign_in'>
      Hello, {{ user.display_name }} |

      {% ifequal user.account_type "friendconnect"%}
        <a href="#" onclick="google.friendconnect.requestSettings()">Settings</a> |
        <a href="#" onclick="google.friendconnect.requestInvite()">Invite</a> |
        <a href="#" onclick="google.friendconnect.requestSignOut(); window.location.reload();">Sign Out</a>
      {% else %} {% ifequal user.account_type "facebook" %}
        <a href="#" onclick="inviteFacebookFriends();">Invite</a> |
        <a href="#" onclick="FB.Connect.logout(function() {window.location.reload();});">Sign Out</a>
      {% endifequal %}{% endifequal %}
    </div>

    <script type="text/javascript">
        function inviteFacebookFriends() {
          var url = location.protocol + "//" + location.host;

          var dialog = new FB.UI.FBMLPopupDialog('Invite your friends to join Footprint', '');
          var fbml = '<fb:fbml><fb:request-form action="' + url 
              + '" method="POST" invite="true" type="One For All" content="Visit ' + url 
              + ' to find volunteer opportunities near you! ' 
              + '<fb:req-choice url=\'' + url  + '\' label=\'Yes, I want to get invovled\' />">' 
              + '<fb:multi-friend-selector rows="2" showborder="false" actiontext="Invite your friends"/>' 
              + '</fb:request-form></fb:fbml>';
          dialog.setFBMLContent(fbml);
          dialog.setContentWidth(600); 
          dialog.setContentHeight(400);
          dialog.show();
        }
    </script>

    {% else %}
    <div class='sign_in'>
      Sign in with <span id="signInProvider"></span> :
      <img src="images/signin-yahoo.gif" alt="Yahoo!" title="Yahoo!" onclick="google.friendconnect.requestSignIn()"/>
      <img src="images/signin-google.gif" alt="Google" title="Google" onclick="google.friendconnect.requestSignIn()"/>
      <img src="images/signin-aol.gif" alt="AOL" title="AOL" onclick="google.friendconnect.requestSignIn()"/>
      <img src="images/signin-facebook.gif" alt="Facebook" title="Facebook" onclick="requestFacebookSignIn()"/>
      <!--img src="images/signin-myspace.gif" alt="MySpace" title="MySpace" onclick="google.friendconnect.requestSignIn()"/-->
      <img src="images/signin-openid.gif" alt="OpenID" title="OpenID" onclick="google.friendconnect.requestSignIn()"/>

      <script type="text/javascript">
        function requestFacebookSignIn() {
          FB.Connect.requireSession(null, true);
          FB.Facebook.get_sessionState().waitUntilReady(function() {
            window.location.reload();
          });
        }

        function checkForViewer() {
          // If the viewer is != null and the userId == null reload page.
          // This is a temporary placeholder until FC gives us an onSignIn callback
          var req = opensocial.newDataRequest();
          req.add(req.newFetchPersonRequest('VIEWER'), 'viewer');
          req.send(function(data) {
            if (data.get('viewer').getData()) { window.location.reload();}
          });
        }
      </script>
    </div>
    {% endif %}
   </nobr>
  </div>

  <div style='clear: both; float: none'></div>
</div>
